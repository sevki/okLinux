#!/bin/bash
set -e
# Copyright oknotok.computer (c) 2024
# All rights reserved
# Licensed under the BSD 3-Clause License

apt-get update -y

dependencies=(
    curl
    git
    unzip
)

apt-get install -y "${dependencies[@]}"

curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --no-modify-path
source ${CARGO_HOME:-~/.cargo}/env

# Download the kernel
curl -L https://oknotok.computer/oklinux-kernel-x86_64-6.6.22-0edade2a0b0a3629edf358f2b290d92fdd6bdd16.tar.gz -o oklinux-kernel-x86_64-6.6.22-0edade2a0b0a3629edf358f2b290d92fdd6bdd16.tar.gz
# Verify the hash
echo "2e05b0335ae9cbad7b05d5ee3d37406ecd84cbc3ad0d0c49239b8fd486f49a0a  oklinux-kernel-x86_64-6.6.22-0edade2a0b0a3629edf358f2b290d92fdd6bdd16.tar.gz" | sha256sum -c -

echo "6.6.22" > kernel-version.txt
