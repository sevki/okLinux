{% extends "base.html" %} {% block title %}Downloads - {{ config.title }}{%
endblock %} {% block content %}
<h1>Downloads</h1>
<p>
    Pre-built okLinux kernel images from the <code>chromeos-6.6</code> branch.
</p>

<div id="releases">
    <p>Loading releases...</p>
</div>

<script>
    (async () => {
        const container = document.getElementById("releases");
        try {
            const res = await fetch(
                "https://api.github.com/repos/sevki/okLinux/releases?per_page=20",
            );
            if (!res.ok) throw new Error(res.statusText);
            const releases = await res.json();

            if (!releases.length) {
                container.innerHTML = "<p>No releases found.</p>";
                return;
            }

            let html = '<ul class="releases">';
            for (const rel of releases) {
                const date = new Date(rel.published_at).toLocaleDateString(
                    "en-US",
                    {
                        year: "numeric",
                        month: "short",
                        day: "numeric",
                    },
                );
                const assets = rel.assets
                    .filter((a) => !a.name.endsWith(".sha256"))
                    .map(
                        (a) =>
                            `<li><a href="${a.browser_download_url}">${a.name}</a> <span class="release-date">(${(a.size / 1048576).toFixed(1)} MB)</span></li>`,
                    )
                    .join("");
                const checksums = rel.assets
                    .filter((a) => a.name.endsWith(".sha256"))
                    .map(
                        (a) =>
                            `<li><a href="${a.browser_download_url}">${a.name}</a></li>`,
                    )
                    .join("");

                html += `<li>
                <span class="release-tag">${rel.tag_name}</span>
                <span class="release-date">${date}</span>
                ${assets || checksums ? `<ul class="release-assets">${assets}${checksums}</ul>` : ""}
            </li>`;
            }
            html += "</ul>";
            container.innerHTML = html;
        } catch (e) {
            container.innerHTML = `<p>Failed to load releases. View them on <a href="https://github.com/sevki/okLinux/releases">GitHub</a>.</p>`;
        }
    })();
</script>
{% endblock %}
