# Sync the upstream ChromeOS kernel into sevki/kernel
#
# Required secrets:
#   KERNEL_REPO_TOKEN - A GitHub Personal Access Token (PAT) with push access
#                       to sevki/kernel. Create a fine-grained PAT at
#                       https://github.com/settings/tokens with "Contents: Read
#                       and write" permission scoped to sevki/kernel, then add
#                       it as a repository secret in sevki/okLinux settings.

name: Sync Kernel

on:
  schedule:
    - cron: "0 0 * * *" # daily at midnight UTC
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Clone upstream ChromeOS kernel
        run: |
          git clone --bare --single-branch --branch chromeos-6.6 \
            https://chromium.googlesource.com/chromiumos/third_party/kernel \
            kernel.git

      - name: Push to sevki/kernel
        run: |
          cd kernel.git
          git remote add target \
            https://x-access-token:${{ secrets.KERNEL_REPO_TOKEN }}@github.com/sevki/kernel.git
          git push target "refs/heads/chromeos-6.6:refs/heads/chromeos-6.6"
